-- doubleをdecimalに変換することの検証

-- テーブルの作成
drop table if exists temp;

CREATE TABLE temp (
   id INT
  ,input VARCHAR(255)
  ,A double
  ,B double  -- -> decimal        = decimal(10, 0)
  ,B0 double -- -> decimal(10)    = decimal(10, 0)
  ,B1 double -- -> decimal(10, 1)
  ,B2 double -- -> decimal(10, 2)
  ,B3 double -- -> decimal(10, 3)
  ,B4 double -- -> decimal(10, 4)
);

-- 桁数確認
INSERT INTO temp (id, input, A, B, B0, B1, B2, B3, B4) VALUES
 (001, '1E-1', 1E-1, 1E-1, 1E-1, 1E-1, 1E-1, 1E-1, 1E-1)
,(002, '1E-2', 1E-2, 1E-2, 1E-2, 1E-2, 1E-2, 1E-2, 1E-2)
,(003, '1E-3', 1E-3, 1E-3, 1E-3, 1E-3, 1E-3, 1E-3, 1E-3)
,(004, '1E-4', 1E-4, 1E-4, 1E-4, 1E-4, 1E-4, 1E-4, 1E-4)
,(005, '1E-5', 1E-5, 1E-5, 1E-5, 1E-5, 1E-5, 1E-5, 1E-5)
,(006, '5E-5', 5E-5, 5E-5, 5E-5, 5E-5, 5E-5, 5E-5, 5E-5)
;

-- 四捨五入
INSERT INTO temp (id, input, A, B, B0, B1, B2, B3, B4) VALUES
 (007, '0.0006' ,0.0006, 0.0006, 0.0006, 0.0006, 0.0006, 0.0006, 0.0006)
,(008, '0.0004' ,0.0004, 0.0004, 0.0004, 0.0004, 0.0004, 0.0004, 0.0004)
,(009, '0.006' ,0.006, 0.006, 0.006, 0.006, 0.006, 0.006, 0.006)
,(010, '0.004' ,0.004, 0.004, 0.004, 0.004, 0.004, 0.004, 0.004)
;

-- 適当な値
INSERT INTO temp (id, input, A, B, B0, B1, B2, B3, B4) VALUES
 (011, '1.0' ,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0)
,(012, '281.12' ,281.12, 281.12, 281.12, 281.12, 281.12, 281.12, 281.12)
,(013, '0.938' ,0.938, 0.938, 0.938, 0.938, 0.938, 0.938, 0.938)
,(014, '15.315' ,15.315, 15.315, 15.315, 15.315, 15.315, 15.315, 15.315)
,(015, '1.234567' , 1.234567, 1.234567, 1.234567, 1.234567, 1.234567, 1.234567, 1.234567)
;

-- doubleをdecimalに変換
alter table temp
  modify column B decimal         -- = decimal(10, 0)
 ,modify column B0 decimal(10)    -- = decimal(10, 0)
 ,modify column B1 decimal(10, 1)
 ,modify column B2 decimal(10, 2)
 ,modify column B3 decimal(10, 3)
 ,modify column B4 decimal(10, 4)
;

-- 結果確認
-- 表示の0を合わせるためにキャスト
select
  id
  ,`input`
  ,CAST(A  AS DECIMAL(10, 6)) AS ORG
  ,CAST(B  AS DECIMAL(10, 6)) AS 'DECIMAL'
  ,CAST(B0 AS DECIMAL(10, 6)) AS 'DECIMAL_10'
  ,CAST(B1 AS DECIMAL(10, 6)) AS 'DECIMAL_10_1'
  ,CAST(B2 AS DECIMAL(10, 6)) AS 'DECIMAL_10_2'
  ,CAST(B3 AS DECIMAL(10, 6)) AS 'DECIMAL_10_3'
  ,CAST(B4 AS DECIMAL(10, 6)) AS 'DECIMAL_10_4'
from temp order by id;

-- id  input            ORG     DECIMAL  DECIMAL_10  DECIMAL_10_1  DECIMAL_10_2  DECIMAL_10_3  DECIMAL_10_4
-- --  --------  ----------  ----------  ----------  ------------  ------------  ------------  ------------
--  1  1E-1        0.100000    0.000000    0.000000      0.100000      0.100000      0.100000      0.100000
--  2  1E-2        0.010000    0.000000    0.000000      0.000000      0.010000      0.010000      0.010000
--  3  1E-3        0.001000    0.000000    0.000000      0.000000      0.000000      0.001000      0.001000
--  4  1E-4        0.000100    0.000000    0.000000      0.000000      0.000000      0.000000      0.000100
--  5  1E-5        0.000010    0.000000    0.000000      0.000000      0.000000      0.000000      0.000000
--  6  5E-5        0.000050    0.000000    0.000000      0.000000      0.000000      0.000000      0.000100
--  7  0.0006      0.000600    0.000000    0.000000      0.000000      0.000000      0.001000      0.000600
--  8  0.0004      0.000400    0.000000    0.000000      0.000000      0.000000      0.000000      0.000400
--  9  0.006       0.006000    0.000000    0.000000      0.000000      0.010000      0.006000      0.006000
-- 10  0.004       0.004000    0.000000    0.000000      0.000000      0.000000      0.004000      0.004000
-- 11  1.0         1.000000    1.000000    1.000000      1.000000      1.000000      1.000000      1.000000
-- 12  281.12    281.120000  281.000000  281.000000    281.100000    281.120000    281.120000    281.120000
-- 13  0.938       0.938000    1.000000    1.000000      0.900000      0.940000      0.938000      0.938000
-- 14  15.315     15.315000   15.000000   15.000000     15.300000     15.320000     15.315000     15.315000
-- 15  1.234567    1.234567    1.000000    1.000000      1.200000      1.230000      1.235000      1.234600

